import pickle
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

# Đọc dữ liệu từ tệp CSV
data = pd.read_csv("D:/Study/HK2 2023_2024/BTL Python/Detec/drebin-215-dataset-5560malware-9476-benign.csv", encoding="utf-8", low_memory=False, na_values="?")

# Tiền xử lý dữ liệu
data["class"] = data["class"].map({"B": 0, "S": 1})
data = data.dropna()

# Chia dữ liệu thành các tập huấn luyện và kiểm tra
X = data.drop("class", axis=1)
y = data["class"]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Xây dựng và huấn luyện mô hình Random Forest
rf = RandomForestClassifier()
rf.fit(X_train, y_train)

# Đánh giá mô hình trên tập kiểm tra
y_pred = rf.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
print("Accuracy:", accuracy)

# Lưu mô hình
with open('random_forest_model.pkl', 'wb') as model_file:
    pickle.dump(rf, model_file)
